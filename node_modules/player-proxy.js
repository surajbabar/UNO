var proxy = {};
var playerModel = require('player.js').player;

var observer;

proxy.createProxy = function (socket, gameMaster) {
    observer = gameMaster;
    var proxyDetails = {player: "", channel: socket};
    socket.on('data', function (text) {
        var data = JSON.parse(text);
        if (data.type == 'introduction') {
            proxyDetails.player = playerModel.createPlayer(data.playerName);
            gameMaster.onPlayerRegistered(proxyDetails.player);
        }
    });
    return proxyDetails;
}

proxy.send = function (playerProxy,game) {
    var snapshot = {};
    game.populate(snapshot, playerProxy.player);
    playerProxy.channel.write(JSON.stringify(snapshot));
}

exports.proxy = proxy;