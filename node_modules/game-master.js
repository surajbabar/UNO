var gameMaster = {};
var gameModel = require('game.js').game;
var playerProxy = require('player-proxy.js').proxy;
var net = require('net');

var totalPlayers;
var players = [];
var proxies = [];
var game;

gameMaster.startGameMaster = function (noOfPacks, noOfPlayers) {
    totalPlayers = noOfPlayers;
    var server = net.createServer();
    server.listen(8080);

    server.on('connection', function (socket) {
        if (proxies.length == totalPlayers) {
            return;
        }
        var proxy = playerProxy.createProxy(socket, this);
        proxies.push(proxy);
        console.log('got ' + proxies.length + ' connections out of ' + totalPlayers);
        if (proxies.length == totalPlayers) {
            startGame();
        }
    });
}

var startGame=function () {
    proxies.forEach(function(proxy){
        playerProxy.send(proxy);
    });
}

gameMaster.onPlayerRegistered = function (player) {
    players.push(player);
    if (players.length == totalPlayers) {
        startGame();
    }
};


exports.gameMaster = gameMaster;
